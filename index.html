<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poli Grupo 2 - Sistema de Comandas</title>
    <style>
        :root {
            --accent: #0081C9;
            --bg: #F1F6F9;
            --dark: #212A3E;
            --danger: #FF6464;
            --success: #54B435;
            --card-bg: #ffffff;
            --text-color: #212A3E;
        }

        [data-theme="dark"] {
            --bg: #121212;
            --dark: #000000;
            --card-bg: #1E1E1E;
            --text-color: #E0E0E0;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; color: var(--text-color); transition: 0.3s; }

        .sidebar {
            position: fixed; left: -300px; top: 0; width: 280px; height: 100%;
            background: var(--dark); color: white; transition: 0.3s; z-index: 2000;
            padding: 20px; box-sizing: border-box; box-shadow: 5px 0 15px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        .sidebar.open { left: 0; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close-btn { background: none; border: none; color: white; font-size: 30px; cursor: pointer; }
        
        #theme-toggle { background: none; border: none; font-size: 24px; cursor: pointer; padding: 5px; border-radius: 10px; }

        .menu-fab {
            position: fixed; bottom: 20px; left: 20px; z-index: 1500;
            background: var(--accent); color: white; border: none;
            padding: 15px 25px; border-radius: 50px; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;
        }

        .logo-bienvenida { width: 280px; max-width: 80%; height: auto; margin-bottom: 20px; border-radius: 20px; }

        .main-content { padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 100px; }

        .categoria-box { 
            background: var(--card-bg); padding: 15px; border-radius: 15px; margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.1);
        }
        
        h3 { margin-top: 0; color: var(--accent); border-bottom: 2px solid var(--accent); padding-bottom: 5px; }

        /* --- CORRECCI√ìN PARA CELULARES --- */
        .producto-row { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            margin-bottom: 12px; 
            flex-wrap: nowrap; /* Evita que el bot√≥n baje */
        }
        
        .producto-row span { 
            font-size: 14px; 
            white-space: nowrap; /* Evita que el nombre del producto se corte en 2 lineas */
            min-width: fit-content;
        }

        select { 
            padding: 10px; 
            border-radius: 8px; 
            border: 1px solid #ddd; 
            font-size: 14px; 
            background: var(--card-bg); 
            color: var(--text-color);
            flex: 1; /* Hace que el select ocupe todo el espacio disponible */
            min-width: 0; /* Permite que el select se encoja si es necesario */
        }

        button.add-btn { 
            background: var(--accent); 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-weight: bold; 
            height: 40px; 
            width: 45px; 
            border-radius: 8px;
            flex-shrink: 0; /* Evita que el bot√≥n se aplaste */
            font-size: 20px;
        }
        /* ---------------------------------- */

        .ticket { background: var(--card-bg); padding: 20px; border-radius: 20px; margin-top: 25px; border: 2px solid var(--accent); }
        .item-pedido { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #ccc; }
        .controles { display: flex; align-items: center; gap: 10px; }
        .btn-qty { background: var(--accent); border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 18px; color: white; }

        .total-box { background: var(--dark); color: white; padding: 20px; border-radius: 15px; display: flex; justify-content: space-between; font-size: 22px; font-weight: bold; margin-top: 20px; }

        .btn-footer { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; color: white; font-size: 16px; }

        .mesa-item { background: #394867; color: white; padding: 12px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; border-left: 5px solid transparent; }
        .mesa-item.cobrada { border-left-color: var(--danger); background: #4b1d1d; }

        .hidden { display: none !important; }
    </style>
</head>
<body data-theme="light">

    <button class="menu-fab" onclick="toggleMenu()">üèñÔ∏è Ver Mesas</button>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 style="margin:0;">üìç Poli 2</h2>
            <button id="theme-toggle" onclick="toggleTheme()">üåô</button>
            <button class="close-btn" onclick="toggleMenu()">‚úï</button>
        </div>
        <button style="width:100%; padding:10px; margin-bottom:20px; cursor:pointer; background:var(--accent); color:white; border:none; border-radius:8px; font-weight:bold;" onclick="crearMesa()">+ Nueva Mesa</button>
        <div id="lista-mesas"></div>
    </aside>

    <main class="main-content">
        <div id="pantalla-vacia" style="text-align:center; margin-top:80px; color:#999;">
            <img src="https://i.postimg.cc/5NYdr39m/40-sin-titulo-20260107033524.png" alt="Logo Poli Grupo 2" class="logo-bienvenida">
            <h2>Selecciona o crea una mesa</h2>
        </div>

        <div id="area-operativa" class="hidden">
            <h1 id="titulo-mesa" style="text-align:center;">Mesa</h1>

            <div class="categoria-box">
                <h3>üçî Comidas</h3>
                <div class="producto-row">
                    <span>üçü Papas:</span>
                    <select id="papas-select">
                        <option value="Papas Cono,3000">Cono $3000</option>
                        <option value="Papas Com√∫n,5000">Bandeja Com√∫n $5000</option>
                        <option value="Papas Cheddar,6000">Bandeja Cheddar $6000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('papas-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>üçï Pizzas:</span>
                    <select id="pizza-select">
                        <option value="Pizza Com√∫n,8000">Com√∫n $8000</option>
                        <option value="Pizza Especial,10000">Especial $10000</option>
                        <option value="Pizza Calabresa,11000">Calabresa $11000</option>
                        <option value="Pizza Provenzal,10000">Provenzal $10000</option>
                        <option value="Pizza Napolitana,10000">Napolitana $10000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('pizza-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>üçî Burger:</span>
                    <select id="burger-select">
                        <option value="Burger Simple,5000">Simple $5000</option>
                        <option value="Burger Completa,8000">Completa $8000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('burger-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>ü•™ S√°ndwich:</span>
                    <select id="sand-select">
                        <option value="Mila Simple,7000">Milanesa Simple $7000</option>
                        <option value="Mila Completo,9000">Milanesa Completo $9000</option>
                        <option value="S. Miga,5000">De Miga $5000</option>
                        <option value="Carlitos,6000">Carlitos $6000</option>
                        <option value="Triples,7000">Triples $7000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('sand-select')">+</button>
                </div>
            </div>

            <div class="categoria-box">
                <h3>üçπ Bebidas</h3>
                <div class="producto-row">
                    <span>ü•§ Gaseosa:</span>
                    <select id="gaseosa-select">
                        <option value="Pepsi 500ml,2000">Pepsi 500ml $2000</option>
                        <option value="Pepsi 1.5L,4000">Pepsi 1.5L $4000</option>
                        <option value="7up 500ml,2000">7up 500ml $2000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('gaseosa-select')">+</button>
                </div>
            </div>

            <div class="ticket">
                <h3>üìù Pedido Mesa <span id="nombre-mesa-ticket"></span></h3>
                <div id="lista-pedidos"></div>
                <div class="total-box">
                    <span>TOTAL</span>
                    <span id="total-precio">$0</span>
                </div>
                <div id="btn-container"></div>
            </div>
        </div>
    </main>

    <script>
        let mesas = JSON.parse(localStorage.getItem('poli_v5')) || {};
        let mesaActual = null;

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('theme-toggle').innerText = isDark ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        window.onload = () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-toggle').innerText = savedTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            renderizarMesas();
        };

        function save() { localStorage.setItem('poli_v5', JSON.stringify(mesas)); }
        function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }

        function crearMesa() {
            const n = prompt("Nombre/Nro Mesa:");
            if (!n || mesas[n]) return;
            mesas[n] = { items: {}, cobrada: false };
            save(); renderizarMesas(); seleccionarMesa(n); toggleMenu();
        }

        function seleccionarMesa(n) {
            mesaActual = n;
            document.getElementById('pantalla-vacia').classList.add('hidden');
            document.getElementById('area-operativa').classList.remove('hidden');
            document.getElementById('titulo-mesa').innerText = `üìç Mesa: ${n}`;
            document.getElementById('nombre-mesa-ticket').innerText = n;
            actualizarTicket(); renderizarMesas();
        }

        function agregarDeSelect(id) {
            const [n, p] = document.getElementById(id).value.split(',');
            agregarProd(n, parseInt(p));
        }

        function agregarProd(n, p) {
            if (!mesaActual || mesas[mesaActual].cobrada) return;
            mesas[mesaActual].items[n] = mesas[mesaActual].items[n] || { precio: p, qty: 0 };
            mesas[mesaActual].items[n].qty++;
            save(); actualizarTicket(); renderizarMesas();
        }

        function cambiarQty(n, d) {
            if (mesas[mesaActual].cobrada) return;
            mesas[mesaActual].items[n].qty += d;
            if (mesas[mesaActual].items[n].qty <= 0) delete mesas[mesaActual].items[n];
            save(); actualizarTicket(); renderizarMesas();
        }

        function actualizarTicket() {
            const m = mesas[mesaActual];
            const container = document.getElementById('lista-pedidos');
            const btnContainer = document.getElementById('btn-container');
            container.innerHTML = "";
            let total = 0;
            for (let n in m.items) {
                const i = m.items[n];
                const sub = i.precio * i.qty;
                total += sub;
                container.innerHTML += `<div class="item-pedido"><div><b>${n}</b><br><small>$${i.precio}</small></div><div class="controles"><button class="btn-qty" onclick="cambiarQty('${n}', -1)">-</button><b>${i.qty}</b><button class="btn-qty" onclick="cambiarQty('${n}', 1)">+</button><b>$${sub}</b></div></div>`;
            }
            document.getElementById('total-precio').innerText = `$${total}`;

            if (m.cobrada) {
                btnContainer.innerHTML = `
                    <button class="btn-footer" style="background:var(--accent)" onclick="reabrir()">‚Ü©Ô∏è Reabrir Mesa</button>
                    <button class="btn-footer" style="background:#25D366" onclick="enviarWhatsapp()">üì± Enviar por WhatsApp</button>
                    <button class="btn-footer" style="background:var(--dark)" onclick="liberar()">üßπ Liberar Mesa</button>
                `;
            } else {
                btnContainer.innerHTML = `<button class="btn-footer" style="background:var(--success)" onclick="cobrar()">üí∞ Cobrar Mesa</button>`;
            }
        }

        function cobrar() { mesas[mesaActual].cobrada = true; save(); actualizarTicket(); renderizarMesas(); }
        function reabrir() { mesas[mesaActual].cobrada = false; save(); actualizarTicket(); renderizarMesas(); }

        function enviarWhatsapp() {
            const m = mesas[mesaActual];
            let msg = `*Poli Grupo 2 - Mesa: ${mesaActual}*\n--------------------------\n`;
            let total = 0;
            for (let n in m.items) {
                const i = m.items[n];
                msg += `- ${i.qty}x ${n}: $${i.precio * i.qty}\n`;
                total += i.precio * i.qty;
            }
            msg += `--------------------------\n*TOTAL: $${total}*`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function liberar() { if (confirm("¬øLimpiar mesa?")) { delete mesas[mesaActual]; mesaActual = null; save(); location.reload(); } }

        function renderizarMesas() {
            const lista = document.getElementById('lista-mesas');
            lista.innerHTML = "";
            for (let n in mesas) {
                const m = mesas[n];
                let t = 0;
                for (let i in m.items) t += m.items[i].precio * m.items[i].qty;
                const div = document.createElement('div');
                div.className = `mesa-item ${m.cobrada ? 'cobrada' : ''}`;
                div.onclick = () => { seleccionarMesa(n); toggleMenu(); };
                div.innerHTML = `Mesa: ${n} <br> <b>Total: $${t}</b> ${m.cobrada ? '(COBRADA)' : ''}`;
                lista.appendChild(div);
            }
        }
    </script>
</body>
</html>