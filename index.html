<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- ‚úÖ Viewport sin zoom (evita doble toque en iOS) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Poli Grupo 2</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#0081C9">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/g2D57d2d/43-sin-titulo-20260107215026.png">
    <link rel="icon" href="https://i.postimg.cc/g2D57d2d/43-sin-titulo-20260107215026.png">

    <style>
        :root {
            --accent: #0081C9; --bg: #F1F6F9; --dark: #212A3E; --danger: #FF6464;
            --success: #54B435; --warning: #FFB100; --card-bg: #ffffff; --text-color: #212A3E;
        }
        [data-theme="dark"] {
            --bg: #121212; --dark: #000000; --card-bg: #1E1E1E; --text-color: #E0E0E0;
        }

        /* ‚úÖ Elimina el "tap highlight" en iOS */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); 
            margin: 0; 
            color: var(--text-color); 
            transition: background-color 0.4s, color 0.4s; 
            padding-top: env(safe-area-inset-top); 
        }

        /* Overlay para cerrar men√∫ al tocar fuera */
        #menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.12);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease;
        }
        body.menu-open #menu-overlay {
            opacity: 1;
            visibility: visible;
        }

        /* ‚úÖ Sidebar: fondo hasta el notch, contenido respetando safe area */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 0; /* llega hasta el borde superior */
            width: 280px;
            height: 100%;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            color: #222;
            transition: left 0.3s ease;
            z-index: 2000;
            padding: 20px;
            padding-top: calc(20px + env(safe-area-inset-top, 0px)); /* contenido bajo el notch */
            box-sizing: border-box;
            overflow-y: auto;
            border-right: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12), 2px 0 12px rgba(0, 0, 0, 0.1);
            -webkit-font-smoothing: antialiased;
        }
        [data-theme="dark"] .sidebar {
            background: rgba(30, 30, 30, 0.35);
            color: #f0f0f0;
            border-right-color: rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08), 2px 0 12px rgba(0, 0, 0, 0.2);
        }
        .sidebar.open { left: 0; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }

        .menu-fab {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1500;
            background: var(--accent);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }
        .menu-fab:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        .menu-fab:active {
            transform: scale(0.95);
        }

        .main-content { padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 100px; }
        .categoria-box { 
            background: var(--card-bg); padding: 15px; border-radius: 15px; margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.1);
            transition: background-color 0.4s, border-color 0.4s;
        }
        h3 { margin-top: 0; color: var(--accent); border-bottom: 2px solid var(--accent); padding-bottom: 5px; }

        .producto-row { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
        .producto-row span { font-size: 14px; white-space: nowrap; min-width: 80px; }
        select { padding: 10px; border-radius: 8px; border: 1px solid #ddd; flex: 1; background: var(--card-bg); color: var(--text-color); min-width: 0; }

        .add-btn, .fast-btn, .btn-qty, .btn-footer {
            transition: all 0.2s ease;
        }

        .add-btn { 
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px;
            height: 42px;
            width: 48px;
            font-size: 20px;
            flex-shrink: 0;
        }
        .add-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .add-btn:active {
            transform: scale(0.95);
        }

        .fast-btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
        .fast-btn { 
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
            font-size: 13px;
            white-space: nowrap;
            text-align: center;
        }
        .fast-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        .fast-btn:active {
            transform: scale(0.98);
        }

        .ticket { 
            background: var(--card-bg); padding: 20px; border-radius: 20px; margin-top: 25px; 
            border: 2px solid var(--accent); transition: background-color 0.4s, border-color 0.4s; 
        }
        .item-pedido { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 0; border-bottom: 1px dashed #ccc;
        }
        .controles { 
            display: flex; align-items: center; gap: 12px; justify-content: flex-end; min-width: 140px;
        }
        .btn-qty { 
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .btn-qty:hover {
            transform: scale(1.1);
        }
        .btn-qty:active {
            transform: scale(0.95);
        }
        .qty-num { font-weight: bold; font-size: 16px; min-width: 20px; text-align: center; }
        .item-info { flex: 1; padding-right: 10px; }
        .item-subtotal { font-weight: bold; min-width: 70px; text-align: right; }
        .nota-mesa { 
            width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; 
            box-sizing: border-box; border: 1px solid var(--warning); 
            background: rgba(255, 177, 0, 0.1); color: var(--text-color); 
            font-family: inherit; resize: none; 
        }
        .total-box { 
            background: var(--dark); color: white; padding: 20px; border-radius: 15px; 
            display: flex; justify-content: space-between; font-size: 22px; font-weight: bold; margin-top: 20px;
            transition: background-color 0.4s;
        }
        .btn-footer { 
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            color: white;
            font-size: 16px;
            background: var(--success);
        }

        .mesa-item { 
            background: #394867; color: white; padding: 12px; border-radius: 10px; 
            margin-bottom: 10px; cursor: pointer; border-left: 5px solid transparent;
            opacity: 0;
            transform: translateY(10px);
            animation: popIn 0.4s forwards;
        }
        .mesa-item.cobrada { 
            border-left-color: var(--danger); background: #4b1d1d; 
        }
        .tiempo-badge { 
            font-size: 0.7rem; background: rgba(255,255,255,0.2); padding: 2px 6px; 
            border-radius: 4px; float: right; 
        }
        .modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); z-index: 3000; 
            display: flex; align-items: center; justify-content: center; 
        }
        .modal-content { 
            background: var(--card-bg); padding: 25px; border-radius: 20px; 
            width: 90%; max-width: 400px; color: var(--text-color); 
        }
        .hidden { display: none !important; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body data-theme="light">

    <button class="menu-fab" onclick="toggleMenu()">üèñÔ∏è Ver Mesas</button>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 style="margin:0;">üìç Poli 2</h2>
            <button id="theme-toggle" onclick="toggleTheme()" style="background:none; border:none; font-size:24px; cursor:pointer;">üåô</button>
            <!-- ‚úÖ Bot√≥n de cerrar SIEMPRE AZUL -->
            <button onclick="toggleMenu()" style="background:none; border:none; font-size:30px; cursor:pointer; color:var(--accent);">‚úï</button>
        </div>
        <button class="btn-footer" style="background:var(--accent); margin-bottom:20px;" onclick="crearMesa()">+ Nueva Mesa</button>
        <div id="lista-mesas"></div>
        <hr style="opacity:0.2; margin:20px 0;">
        <button class="btn-footer" style="background:var(--success)" onclick="verCierreCaja()">üìä Cierre de Caja</button>
    </aside>

    <main class="main-content">
        <div id="pantalla-vacia" style="text-align:center; margin-top:80px;">
            <img src="https://i.postimg.cc/h4Nq8SXn/42-sin-titulo-20260107214826.png" alt="Logo" style="width:250px; border-radius:20px;">
            <h2>Bienvenido a Poli grupo 2‚òÄÔ∏è</h2>
        </div>

        <div id="area-operativa" class="hidden">
            <h1 id="titulo-mesa" style="text-align:center;">Mesa</h1>

            <!-- Secciones de productos (igual que antes) -->
            <div class="categoria-box">
                <h3>üçî Comidas</h3>
                <div class="producto-row">
                    <span>üçü Papas:</span>
                    <select id="papas-select">
                        <option value="Papas Cono,3000">Cono $3000</option>
                        <option value="Bandeja Com√∫n,5000">Bandeja Com√∫n $5000</option>
                        <option value="Bandeja Cheddar,6000">Bandeja Cheddar $6000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('papas-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>üçï Pizzas:</span>
                    <select id="pizza-select">
                        <option value="Pizza Com√∫n,8000">Com√∫n $8000</option>
                        <option value="Pizza Especial,10000">Especial $10000</option>
                        <option value="Pizza Calabresa,11000">Calabresa $11000</option>
                        <option value="Pizza Provenzal,10000">Provenzal $10000</option>
                        <option value="Pizza Napolitana,10000">Napolitana $10000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('pizza-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>ü•™ S√°ndwich:</span>
                    <select id="sand-select">
                        <option value="Mila Simple,7000">Mila Simple $7000</option>
                        <option value="Mila Completo,9000">Mila Completo $9000</option>
                        <option value="S. Miga,5000">Miga $5000</option>
                        <option value="Carlitos,6000">Carlitos $6000</option>
                        <option value="Triples,7000">Triples $7000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('sand-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>ü•ß Tartas:</span>
                    <select id="tarta-select">
                        <option value="Tarta J&Q,10000">J&Q Entera $10000</option>
                        <option value="1/2 Tarta J&Q,6000">J&Q Media $6000</option>
                        <option value="Tarta Verdura,10000">Verdura Entera $10000</option>
                        <option value="1/2 Tarta Verdura,6000">Verdura Media $6000</option>
                        <option value="Tarta Pollo,11000">Pollo Entera $11000</option>
                        <option value="1/2 Tarta Pollo,7000">Pollo Media $7000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('tarta-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>ü•ü Empan.:</span>
                    <select id="empa-select">
                        <option value="Empa. Carne c/u,1200">Carne $1200</option>
                        <option value="Docena Carne,12000">Docena Carne $12k</option>
                        <option value="Empa. Pollo c/u,1200">Pollo $1200</option>
                        <option value="Docena Pollo,12000">Docena Pollo $12k</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('empa-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>üå≠ Panchos:</span>
                    <select id="pancho-select">
                        <option value="Pancho,1500">Simple $1500</option>
                        <option value="Combo Pancho+Lata,3000">Combo (+Lata) $3000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('pancho-select')">+</button>
                </div>
                <div class="fast-btn-group">
                    <button class="fast-btn" onclick="agregarProd('Dona', 700)">üç© Dona $700</button>
                    <button class="fast-btn" onclick="agregarProd('Torta Frita', 500)">ü•Ø T. Frita $500</button>
                    <button class="fast-btn" onclick="agregarProd('Picada', 20000)">üßÄ Picada $20k</button>
                </div>
            </div>

            <div class="categoria-box">
                <h3>üçπ Bebidas</h3>
                <div class="producto-row">
                    <span>ü•§ Pepsi/7up:</span>
                    <select id="gaseosa-select">
                        <option value="Pepsi 500ml,2000">Pepsi 500ml $2000</option>
                        <option value="Pepsi Lata,2000">Pepsi Lata $2000</option>
                        <option value="Pepsi 1.5L,4000">Pepsi 1.5L $4000</option>
                        <option value="7up 500ml,2000">7up 500ml $2000</option>
                        <option value="7up Lata,2000">7up Lata $2000</option>
                        <option value="7up 1.5L,4000">7up 1.5L $4000</option>
                        <option value="Mirinda 1.5L,3500">Mirinda 1.5L $3500</option>
                        <option value="H2O 1.5L,3500">H2O Citrus $3500</option>
                        <option value="Paso Toros 1.5L,4000">P. Toros 1.5L $4000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('gaseosa-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>üç∫ Cervezas:</span>
                    <select id="birra-select">
                        <option value="Quilmes 1L,4500">Quilmes 1L $4500</option>
                        <option value="Quilmes Negra 1L,4500">Quilmes Negra $4500</option>
                        <option value="Budweiser 1L,5000">Budweiser 1L $5000</option>
                        <option value="Lata Budweiser,2000">Lata Bud $2000</option>
                        <option value="Brahma 1L,4500">Brahma 1L $4500</option>
                        <option value="Stella 1L,4500">Stella 1L $4500</option>
                        <option value="Corona 330ml,3500">Corona 330ml $3500</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('birra-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>üíß Agua/Gator.:</span>
                    <select id="agua-select">
                        <option value="Agua 500ml,2000">Agua 500ml $2000</option>
                        <option value="Agua 1.5L,2500">Agua 1.5L $2500</option>
                        <option value="Gatorade,5000">Gatorade $5000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('agua-select')">+</button>
                </div>
                <div class="producto-row">
                    <span>üç∑ Vinos/Jarra:</span>
                    <select id="vino-select">
                        <option value="Nanpe Tinto,4000">Nanpe Tinto $4000</option>
                        <option value="Alma Mora,8000">Alma Mora $8000</option>
                        <option value="Chacabuco Blanco,8000">Chacabuco B. $8000</option>
                        <option value="Jarra Fernet,8000">Jarra Fernet $8000</option>
                        <option value="Jarra Gancia,6000">Jarra Gancia $6000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('vino-select')">+</button>
                </div>
            </div>

            <div class="categoria-box">
                <h3>üçì Postres</h3>
                <div class="producto-row">
                    <span>üçß Ens. Fruta:</span>
                    <select id="fruit-select">
                        <option value="Ens. Fruta 250ml,2000">250ml $2000</option>
                        <option value="Ens. Fruta 500ml,4000">500ml $4000</option>
                    </select>
                    <button class="add-btn" onclick="agregarDeSelect('fruit-select')">+</button>
                </div>
            </div>

            <div class="ticket">
                <h3>üìù Mesa <span id="nombre-mesa-ticket"></span></h3>
                <textarea id="nota-input" class="nota-mesa" placeholder="Notas del pedido (Ej: Papas sin sal)..." onchange="guardarNota()"></textarea>
                <div id="lista-pedidos"></div>
                <div class="total-box"><span>TOTAL</span><span id="total-precio">$0</span></div>
                <div id="btn-container"></div>
            </div>
        </div>
    </main>

    <!-- Overlay para cerrar men√∫ -->
    <div id="menu-overlay" class="hidden" onclick="toggleMenu()"></div>

    <div id="modal-caja" class="modal hidden">
        <div class="modal-content">
            <h3 style="text-align:center;">üìä Cierre de Caja</h3>
            <div id="caja-detalle" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div>
            <h2 id="caja-total" style="text-align:center; color:var(--success);"></h2>
            <button class="btn-footer" style="background:var(--accent)" onclick="document.getElementById('modal-caja').classList.add('hidden')">Cerrar</button>
            <button class="btn-footer" style="background:var(--danger); opacity:0.7;" onclick="reiniciarCaja()">Reiniciar D√≠a</button>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
        }

        let mesas = JSON.parse(localStorage.getItem('poli_vFinal')) || {};
        let historial = JSON.parse(localStorage.getItem('poli_historial')) || [];
        let mesaActual = null;

        function save() { 
            localStorage.setItem('poli_vFinal', JSON.stringify(mesas)); 
            localStorage.setItem('poli_historial', JSON.stringify(historial));
        }

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('theme-toggle').innerText = isDark ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        function crearMesa() {
            const n = prompt("Nombre/Nro Mesa:");
            if (!n || mesas[n]) return;
            mesas[n] = { items: {}, cobrada: false, nota: "", inicio: Date.now() };
            save(); renderizarMesas(); seleccionarMesa(n); toggleMenu();
        }

        function seleccionarMesa(n) {
            mesaActual = n;
            document.getElementById('pantalla-vacia').classList.add('hidden');
            document.getElementById('area-operativa').classList.remove('hidden');
            document.getElementById('titulo-mesa').innerText = `üìç Mesa: ${n}`;
            document.getElementById('nombre-mesa-ticket').innerText = n;
            document.getElementById('nota-input').value = mesas[n].nota || "";
            actualizarTicket(); renderizarMesas();
        }

        function agregarDeSelect(id) {
            const [n, p] = document.getElementById(id).value.split(',');
            agregarProd(n, parseInt(p));
        }

        function agregarProd(n, p) {
            if (!mesaActual || mesas[mesaActual].cobrada) return;
            mesas[mesaActual].items[n] = mesas[mesaActual].items[n] || { precio: p, qty: 0 };
            mesas[mesaActual].items[n].qty++;
            save(); actualizarTicket();
        }

        function cambiarQty(n, d) {
            if (mesas[mesaActual].cobrada) return;
            mesas[mesaActual].items[n].qty += d;
            if (mesas[mesaActual].items[n].qty <= 0) delete mesas[mesaActual].items[n];
            save(); actualizarTicket();
        }

        function guardarNota() { if (mesaActual) { mesas[mesaActual].nota = document.getElementById('nota-input').value; save(); } }

        function actualizarTicket() {
            const m = mesas[mesaActual];
            const container = document.getElementById('lista-pedidos');
            container.innerHTML = ""; let total = 0;
            for (let n in m.items) {
                const i = m.items[n]; 
                const subtotal = i.precio * i.qty;
                total += subtotal;
                container.innerHTML += `
                <div class="item-pedido">
                    <div class="item-info">
                        <b>${n}</b><br><small>$${i.precio}</small>
                    </div>
                    <div class="controles">
                        <button class="btn-qty" onclick="cambiarQty('${n}', -1)">-</button>
                        <span class="qty-num">${i.qty}</span>
                        <button class="btn-qty" onclick="cambiarQty('${n}', 1)">+</button>
                    </div>
                    <div class="item-subtotal">$${subtotal}</div>
                </div>`;
            }
            document.getElementById('total-precio').innerText = `$${total}`;
            const btnContainer = document.getElementById('btn-container');
            if (m.cobrada) {
                btnContainer.innerHTML = `<button class="btn-footer" style="background:var(--accent)" onclick="reabrir()">‚Ü©Ô∏è Reabrir</button>
                <button class="btn-footer" style="background:#25D366" onclick="enviarWhatsapp()">üì± WhatsApp</button>
                <button class="btn-footer" style="background:var(--dark)" onclick="liberar()">üßπ Liberar Mesa</button>`;
            } else {
                btnContainer.innerHTML = `<button class="btn-footer" style="background:var(--success)" onclick="cobrar()">üí∞ Cobrar Mesa</button>`;
            }
        }

        function cobrar() {
            const m = mesas[mesaActual]; m.cobrada = true;
            let totalMesa = 0; for(let n in m.items) totalMesa += m.items[n].precio * m.items[n].qty;
            const index = historial.findIndex(v => v.mesa === mesaActual);
            const venta = { mesa: mesaActual, total: totalMesa, fecha: new Date().toLocaleTimeString() };
            if (index !== -1) historial[index] = venta; else historial.push(venta);
            save(); actualizarTicket(); renderizarMesas();
        }

        function verCierreCaja() {
            const modal = document.getElementById('modal-caja');
            const detalle = document.getElementById('caja-detalle');
            let totalGral = 0; detalle.innerHTML = "";
            historial.forEach(v => {
                totalGral += v.total;
                detalle.innerHTML += `<div style="border-bottom:1px solid #eee; padding:8px; display:flex; justify-content:space-between">
                    <span>Mesa ${v.mesa} (${v.fecha})</span><b>$${v.total}</b>
                </div>`;
            });
            document.getElementById('caja-total').innerText = "TOTAL D√çA: $" + totalGral;
            modal.classList.remove('hidden');
        }

        // ‚úÖ Reiniciar d√≠a: borra mesas Y cierre
        function reiniciarCaja() {
            if (confirm("¬øLimpiar historial y todas las mesas?")) {
                historial = [];
                mesas = {};
                save();
                location.reload();
            }
        }

        function reabrir() { mesas[mesaActual].cobrada = false; save(); actualizarTicket(); renderizarMesas(); }
        function liberar() { if(confirm("¬øLimpiar mesa?")) { delete mesas[mesaActual]; save(); location.reload(); } }

        // ‚úÖ Toggle con overlay
        function toggleMenu() { 
            const sidebar = document.getElementById('sidebar');
            const body = document.body;
            const overlay = document.getElementById('menu-overlay');
            const isOpen = sidebar.classList.contains('open');
            
            if (isOpen) {
                sidebar.classList.remove('open');
                body.classList.remove('menu-open');
                overlay.classList.add('hidden');
            } else {
                sidebar.classList.add('open');
                body.classList.add('menu-open');
                overlay.classList.remove('hidden');
            }
        }

        function enviarWhatsapp() {
            const m = mesas[mesaActual];
            let msg = `*Poli Grupo 2 - Mesa: ${mesaActual}*\n`;
            let total = 0;
            for (let n in m.items) {
                const i = m.items[n]; msg += `- ${i.qty}x ${n}: $${i.precio * i.qty}\n`; total += i.precio * i.qty;
            }
            if(m.nota) msg += `_Nota: ${m.nota}_\n`;
            msg += `*TOTAL: $${total}*`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function renderizarMesas() {
            const lista = document.getElementById('lista-mesas');
            lista.innerHTML = "";
            for (let n in mesas) {
                const m = mesas[n];
                const min = Math.floor((Date.now() - m.inicio) / 60000);
                let t = 0; for (let i in m.items) t += m.items[i].precio * m.items[i].qty;
                lista.innerHTML += `<div class="mesa-item ${m.cobrada ? 'cobrada' : ''}" onclick="seleccionarMesa('${n}'); toggleMenu();">
                    <span class="tiempo-badge">‚è±Ô∏è ${min}m</span>Mesa: ${n} <br><b>$${t}</b>
                </div>`;
            }
        }

        setInterval(renderizarMesas, 30000);
        window.onload = () => { 
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            renderizarMesas(); 
        };
    </script>
</body>
</html>